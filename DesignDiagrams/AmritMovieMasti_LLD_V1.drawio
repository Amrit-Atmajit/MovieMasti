<mxfile host="app.diagrams.net" modified="2025-10-04T00:00:00.000Z" agent="5.0" version="21.0.0" etag="drawio" type="device">
  <diagram name="Microservices Architecture" id="architecture">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title1" value="BookMyShow - Microservices Architecture with SAGA &amp; CQRS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="600" height="40" as="geometry" />
        </mxCell>
        
        <!-- API Gateway -->
        <mxCell id="gateway" value="API Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- User Service -->
        <mxCell id="userService" value="User Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Movie Service -->
        <mxCell id="movieService" value="Movie Service&#xa;(CQRS Pattern)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="240" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Booking Service -->
        <mxCell id="bookingService" value="Booking Service&#xa;(SAGA Orchestrator)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="400" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Payment Service -->
        <mxCell id="paymentService" value="Payment Service&#xa;(SAGA Participant)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="560" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Notification Service -->
        <mxCell id="notificationService" value="Notification Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="720" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Inventory Service -->
        <mxCell id="inventoryService" value="Inventory Service&#xa;(SAGA Participant)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="880" y="200" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Databases -->
        <mxCell id="userDB" value="User DB&#xa;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="100" y="320" width="80" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="movieWriteDB" value="Movie Write DB&#xa;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="200" y="320" width="80" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="movieReadDB" value="Movie Read DB&#xa;(MongoDB)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="300" y="320" width="80" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="bookingDB" value="Booking DB&#xa;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="420" y="320" width="80" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="paymentDB" value="Payment DB&#xa;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="580" y="320" width="80" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="inventoryDB" value="Inventory DB&#xa;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="900" y="320" width="80" height="80" as="geometry" />
        </mxCell>
        
        <!-- Redis Cache -->
        <mxCell id="redis" value="Redis Cache&#xa;(Seat Locks, Session)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="420" y="440" width="100" height="80" as="geometry" />
        </mxCell>
        
        <!-- Event Bus -->
        <mxCell id="kafka" value="Event Bus (Kafka)&#xa;- BookingEvents&#xa;- PaymentEvents&#xa;- NotificationEvents" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="380" y="560" width="400" height="80" as="geometry" />
        </mxCell>
        
        <!-- SAGA State DB -->
        <mxCell id="sagaDB" value="SAGA State DB&#xa;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="260" y="440" width="100" height="80" as="geometry" />
        </mxCell>
        
        <!-- Connections -->
        <mxCell id="edge1" edge="1" parent="1" source="gateway" target="userService">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge2" edge="1" parent="1" source="gateway" target="movieService">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge3" edge="1" parent="1" source="gateway" target="bookingService">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge4" edge="1" parent="1" source="gateway" target="paymentService">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge5" edge="1" parent="1" source="userService" target="userDB">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge6" edge="1" parent="1" source="movieService" target="movieWriteDB">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge7" edge="1" parent="1" source="movieService" target="movieReadDB">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge8" edge="1" parent="1" source="bookingService" target="bookingDB">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge9" edge="1" parent="1" source="paymentService" target="paymentDB">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge10" edge="1" parent="1" source="inventoryService" target="inventoryDB">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge11" edge="1" parent="1" source="bookingService" target="redis" style="dashed=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge12" edge="1" parent="1" source="bookingService" target="sagaDB">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge13" edge="1" parent="1" source="bookingService" target="kafka">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge14" edge="1" parent="1" source="paymentService" target="kafka">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge15" edge="1" parent="1" source="notificationService" target="kafka">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="edge16" edge="1" parent="1" source="inventoryService" target="kafka">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="Class Diagram - Booking Service SAGA" id="class-booking">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <mxCell id="title2" value="Booking Service - Class Diagram (SAGA Pattern)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="500" height="40" as="geometry" />
        </mxCell>
        
        <!-- BookingService -->
        <mxCell id="BookingService" value="&lt;&lt;Service&gt;&gt;&#xa;BookingService" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="280" height="220" as="geometry" />
        </mxCell>
        <mxCell id="BookingService-attr" value="- bookingRepository: BookingRepository&#xa;- sagaOrchestrator: SagaOrchestrator&#xa;- eventPublisher: EventPublisher&#xa;- seatLockManager: SeatLockManager" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="BookingService">
          <mxGeometry y="40" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="BookingService-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="BookingService">
          <mxGeometry y="120" width="280" height="8" as="geometry" />
        </mxCell>
        <mxCell id="BookingService-methods" value="+ createBooking(request): BookingResponse&#xa;+ confirmBooking(bookingId): void&#xa;+ cancelBooking(bookingId): void&#xa;+ getBookingById(bookingId): Booking&#xa;+ handleSagaEvent(event): void" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="BookingService">
          <mxGeometry y="128" width="280" height="92" as="geometry" />
        </mxCell>
        
        <!-- SagaOrchestrator -->
        <mxCell id="SagaOrchestrator" value="&lt;&lt;Component&gt;&gt;&#xa;SagaOrchestrator" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="440" y="80" width="280" height="240" as="geometry" />
        </mxCell>
        <mxCell id="SagaOrchestrator-attr" value="- sagaStateRepository: SagaStateRepository&#xa;- eventBus: EventBus&#xa;- compensationHandler: CompensationHandler" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SagaOrchestrator">
          <mxGeometry y="40" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="SagaOrchestrator-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="SagaOrchestrator">
          <mxGeometry y="100" width="280" height="8" as="geometry" />
        </mxCell>
        <mxCell id="SagaOrchestrator-methods" value="+ startSaga(bookingId): SagaState&#xa;+ processStep(sagaId, step): void&#xa;+ compensate(sagaId): void&#xa;+ getSagaState(sagaId): SagaState&#xa;+ updateSagaState(sagaState): void&#xa;+ handleStepSuccess(sagaId, step): void&#xa;+ handleStepFailure(sagaId, step): void" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SagaOrchestrator">
          <mxGeometry y="108" width="280" height="132" as="geometry" />
        </mxCell>
        
        <!-- SagaState -->
        <mxCell id="SagaState" value="&lt;&lt;Entity&gt;&gt;&#xa;SagaState" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="800" y="80" width="280" height="240" as="geometry" />
        </mxCell>
        <mxCell id="SagaState-attr" value="- sagaId: String&#xa;- bookingId: String&#xa;- currentStep: SagaStep&#xa;- status: SagaStatus&#xa;- steps: List&lt;SagaStepState&gt;&#xa;- createdAt: DateTime&#xa;- updatedAt: DateTime&#xa;- compensationData: Map&lt;String, Object&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SagaState">
          <mxGeometry y="40" width="280" height="120" as="geometry" />
        </mxCell>
        <mxCell id="SagaState-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="SagaState">
          <mxGeometry y="160" width="280" height="8" as="geometry" />
        </mxCell>
        <mxCell id="SagaState-methods" value="+ moveToNextStep(): void&#xa;+ markStepComplete(step): void&#xa;+ markStepFailed(step): void&#xa;+ canCompensate(): boolean" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SagaState">
          <mxGeometry y="168" width="280" height="72" as="geometry" />
        </mxCell>
        
        <!-- SagaStep Enum -->
        <mxCell id="SagaStep" value="&lt;&lt;Enumeration&gt;&gt;&#xa;SagaStep" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="800" y="360" width="200" height="140" as="geometry" />
        </mxCell>
        <mxCell id="SagaStep-values" value="SEAT_LOCK&#xa;INVENTORY_RESERVE&#xa;PAYMENT_PROCESS&#xa;BOOKING_CONFIRM&#xa;NOTIFICATION_SEND" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SagaStep">
          <mxGeometry y="40" width="200" height="100" as="geometry" />
        </mxCell>
        
        <!-- Booking Entity -->
        <mxCell id="Booking" value="&lt;&lt;Entity&gt;&gt;&#xa;Booking" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="360" width="280" height="280" as="geometry" />
        </mxCell>
        <mxCell id="Booking-attr" value="- bookingId: String&#xa;- userId: String&#xa;- showId: String&#xa;- seatIds: List&lt;String&gt;&#xa;- totalAmount: BigDecimal&#xa;- bookingStatus: BookingStatus&#xa;- sagaId: String&#xa;- version: Long&#xa;- createdAt: DateTime&#xa;- expiresAt: DateTime&#xa;- confirmedAt: DateTime" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="Booking">
          <mxGeometry y="40" width="280" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Booking-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="Booking">
          <mxGeometry y="200" width="280" height="8" as="geometry" />
        </mxCell>
        <mxCell id="Booking-methods" value="+ calculateTotal(): BigDecimal&#xa;+ confirm(): void&#xa;+ cancel(): void&#xa;+ isExpired(): boolean" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="Booking">
          <mxGeometry y="208" width="280" height="72" as="geometry" />
        </mxCell>
        
        <!-- BookingEvent -->
        <mxCell id="BookingEvent" value="&lt;&lt;Event&gt;&gt;&#xa;BookingEvent" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="440" y="380" width="260" height="180" as="geometry" />
        </mxCell>
        <mxCell id="BookingEvent-attr" value="- eventId: String&#xa;- bookingId: String&#xa;- sagaId: String&#xa;- eventType: EventType&#xa;- payload: Map&lt;String, Object&gt;&#xa;- timestamp: DateTime" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="BookingEvent">
          <mxGeometry y="40" width="260" height="100" as="geometry" />
        </mxCell>
        <mxCell id="BookingEvent-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="BookingEvent">
          <mxGeometry y="140" width="260" height="8" as="geometry" />
        </mxCell>
        <mxCell id="BookingEvent-methods" value="+ getEventType(): EventType&#xa;+ getPayload(): Map" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="BookingEvent">
          <mxGeometry y="148" width="260" height="32" as="geometry" />
        </mxCell>
        
        <!-- Relationships -->
        <mxCell id="rel1" edge="1" parent="1" source="BookingService" target="SagaOrchestrator" style="endArrow=diamond;endFill=0;endSize=12;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel2" edge="1" parent="1" source="SagaOrchestrator" target="SagaState" style="endArrow=open;endFill=0;dashed=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel3" edge="1" parent="1" source="BookingService" target="Booking" style="endArrow=open;endFill=0;dashed=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel4" edge="1" parent="1" source="SagaOrchestrator" target="BookingEvent" style="endArrow=open;endFill=0;dashed=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel5" edge="1" parent="1" source="SagaState" target="SagaStep" style="endArrow=open;endFill=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="Class Diagram - Movie Service CQRS" id="class-movie">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <mxCell id="title3" value="Movie Service - Class Diagram (CQRS Pattern)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="500" height="40" as="geometry" />
        </mxCell>
        
        <!-- Command Side -->
        <mxCell id="commandLabel" value="COMMAND SIDE (Write)" style="text;html=1;strokeColor=none;fillColor=#dae8fc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="300" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="MovieCommandService" value="&lt;&lt;Service&gt;&gt;&#xa;MovieCommandService" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="130" width="280" height="200" as="geometry" />
        </mxCell>
        <mxCell id="MovieCommandService-attr" value="- movieWriteRepository: MovieRepository&#xa;- eventPublisher: EventPublisher&#xa;- validator: MovieValidator" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieCommandService">
          <mxGeometry y="40" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="MovieCommandService-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="MovieCommandService">
          <mxGeometry y="100" width="280" height="8" as="geometry" />
        </mxCell>
        <mxCell id="MovieCommandService-methods" value="+ createMovie(command): MovieId&#xa;+ updateMovie(command): void&#xa;+ deleteMovie(movieId): void&#xa;+ createShow(command): ShowId" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieCommandService">
          <mxGeometry y="108" width="280" height="92" as="geometry" />
        </mxCell>
        
        <!-- Movie Write Model -->
        <mxCell id="MovieWriteModel" value="&lt;&lt;Entity&gt;&gt;&#xa;Movie (Write Model)" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="370" width="280" height="220" as="geometry" />
        </mxCell>
        <mxCell id="MovieWriteModel-attr" value="- movieId: String&#xa;- title: String&#xa;- description: String&#xa;- duration: Integer&#xa;- genre: List&lt;String&gt;&#xa;- language: String&#xa;- releaseDate: LocalDate&#xa;- version: Long&#xa;- updatedAt: DateTime" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieWriteModel">
          <mxGeometry y="40" width="280" height="140" as="geometry" />
        </mxCell>
        <mxCell id="MovieWriteModel-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="MovieWriteModel">
          <mxGeometry y="180" width="280" height="8" as="geometry" />
        </mxCell>
        <mxCell id="MovieWriteModel-methods" value="+ update(command): void" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieWriteModel">
          <mxGeometry y="188" width="280" height="32" as="geometry" />
        </mxCell>
        
        <!-- Query Side -->
        <mxCell id="queryLabel" value="QUERY SIDE (Read)" style="text;html=1;strokeColor=none;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="80" width="300" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="MovieQueryService" value="&lt;&lt;Service&gt;&gt;&#xa;MovieQueryService" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="480" y="130" width="300" height="220" as="geometry" />
        </mxCell>
        <mxCell id="MovieQueryService-attr" value="- movieReadRepository: MovieReadRepository&#xa;- showReadRepository: ShowReadRepository&#xa;- cacheManager: CacheManager" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieQueryService">
          <mxGeometry y="40" width="300" height="60" as="geometry" />
        </mxCell>
        <mxCell id="MovieQueryService-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="MovieQueryService">
          <mxGeometry y="100" width="300" height="8" as="geometry" />
        </mxCell>
        <mxCell id="MovieQueryService-methods" value="+ getMovieById(movieId): MovieReadModel&#xa;+ searchMovies(criteria): List&lt;MovieReadModel&gt;&#xa;+ getShowsByMovie(movieId, city): List&lt;ShowView&gt;&#xa;+ getAvailableSeats(showId): SeatAvailability&#xa;+ getNowShowing(city): List&lt;MovieReadModel&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieQueryService">
          <mxGeometry y="108" width="300" height="112" as="geometry" />
        </mxCell>
        
        <!-- Movie Read Model -->
        <mxCell id="MovieReadModel" value="&lt;&lt;Document&gt;&gt;&#xa;MovieReadModel" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="480" y="370" width="300" height="260" as="geometry" />
        </mxCell>
        <mxCell id="MovieReadModel-attr" value="- movieId: String&#xa;- title: String&#xa;- description: String&#xa;- duration: Integer&#xa;- genre: List&lt;String&gt;&#xa;- language: String&#xa;- releaseDate: LocalDate&#xa;- rating: Double&#xa;- posterUrl: String&#xa;- theaters: List&lt;TheaterSummary&gt;&#xa;- upcomingShows: List&lt;ShowSummary&gt;&#xa;- lastUpdated: DateTime" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieReadModel">
          <mxGeometry y="40" width="300" height="180" as="geometry" />
        </mxCell>
        <mxCell id="MovieReadModel-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="MovieReadModel">
          <mxGeometry y="220" width="300" height="8" as="geometry" />
        </mxCell>
        <mxCell id="MovieReadModel-methods" value="+ isNowShowing(): boolean" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieReadModel">
          <mxGeometry y="228" width="300" height="32" as="geometry" />
        </mxCell>
        
        <!-- Event Handler -->
        <mxCell id="MovieEventHandler" value="&lt;&lt;Component&gt;&gt;&#xa;MovieEventHandler" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="850" y="130" width="280" height="180" as="geometry" />
        </mxCell>
        <mxCell id="MovieEventHandler-attr" value="- movieReadRepository: MovieReadRepository&#xa;- eventBus: EventBus" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieEventHandler">
          <mxGeometry y="40" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="MovieEventHandler-line" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="MovieEventHandler">
          <mxGeometry y="80" width="280" height="8" as="geometry" />
        </mxCell>
        <mxCell id="MovieEventHandler-methods" value="+ handleMovieCreated(event): void&#xa;+ handleMovieUpdated(event): void&#xa;+ handleMovieDeleted(event): void&#xa;+ handleShowCreated(event): void&#xa;+ syncReadModel(movieId): void" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MovieEventHandler">
          <mxGeometry y="88" width="280" height="92" as="geometry" />
        </mxCell>
        
        <!-- Relationships -->
        <mxCell id="relM1" edge="1" parent="1" source="MovieCommandService" target="MovieWriteModel" style="endArrow=open;endFill=0;dashed=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="relM2" edge="1" parent="1" source="MovieQueryService" target="MovieReadModel" style="endArrow=open;endFill=0;dashed=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="relM3" edge="1" parent="1" source="MovieEventHandler" target="MovieReadModel" style="endArrow=open;endFill=0;dashed=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="relM4" value="publishes events" edge="1" parent="1" source="MovieCommandService" target="MovieEventHandler" style="endArrow=open;endFill=0;dashed=1;dashPattern=8 8;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Sync Arrow -->
        <mxCell id="syncArrow" value="Event-driven Sync" edge="1" parent="1" source="MovieWriteModel" target="MovieReadModel" style="endArrow=open;endFill=0;dashed=1;strokeColor=#d79b00;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="480" as="sourcePoint" />
            <mxPoint x="480" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="ER Diagram - Complete Schema" id="er-complete">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <mxCell id="titleER" value="Complete ER Diagram - Microservices with SAGA &amp; CQRS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>
        
        <!-- USER Table -->
        <mxCell id="USER" value="USER" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="200" height="190" as="geometry" />
        </mxCell>
        <mxCell id="USER-attrs" value="PK user_id: UUID&#xa;   name: VARCHAR(100)&#xa;   email: VARCHAR(255) UNIQUE&#xa;   phone_number: VARCHAR(20)&#xa;   password_hash: VARCHAR(255)&#xa;   status: ENUM&#xa;   created_at: TIMESTAMP&#xa;   updated_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="USER">
          <mxGeometry y="26" width="200" height="164" as="geometry" />
        </mxCell>
        
        <!-- MOVIE (Write Model) Table -->
        <mxCell id="MOVIE_WRITE" value="MOVIE (Write DB)" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="340" width="220" height="220" as="geometry" />
        </mxCell>
        <mxCell id="MOVIE_WRITE-attrs" value="PK movie_id: UUID&#xa;   title: VARCHAR(255)&#xa;   description: TEXT&#xa;   duration: INTEGER&#xa;   genre: VARCHAR[]&#xa;   language: VARCHAR(50)&#xa;   release_date: DATE&#xa;   poster_url: VARCHAR(500)&#xa;   version: BIGINT&#xa;   created_at: TIMESTAMP&#xa;   updated_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MOVIE_WRITE">
          <mxGeometry y="26" width="220" height="194" as="geometry" />
        </mxCell>
        
        <!-- MOVIE_READ (MongoDB Document) -->
        <mxCell id="MOVIE_READ" value="MOVIE_READ (MongoDB)" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="360" y="340" width="240" height="280" as="geometry" />
        </mxCell>
        <mxCell id="MOVIE_READ-attrs" value="_id: ObjectId&#xa;movie_id: String&#xa;title: String&#xa;description: String&#xa;duration: Number&#xa;genre: Array&lt;String&gt;&#xa;language: String&#xa;release_date: Date&#xa;rating: Number&#xa;poster_url: String&#xa;theaters: Array&lt;TheaterSummary&gt;&#xa;upcoming_shows: Array&lt;ShowSummary&gt;&#xa;seat_availability: Map&#xa;last_updated: Date" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="MOVIE_READ">
          <mxGeometry y="26" width="240" height="254" as="geometry" />
        </mxCell>
        
        <!-- THEATER Table -->
        <mxCell id="THEATER" value="THEATER" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="680" y="100" width="200" height="180" as="geometry" />
        </mxCell>
        <mxCell id="THEATER-attrs" value="PK theater_id: UUID&#xa;   name: VARCHAR(255)&#xa;   address: TEXT&#xa;   city: VARCHAR(100)&#xa;   pincode: VARCHAR(10)&#xa;   latitude: DECIMAL&#xa;   longitude: DECIMAL&#xa;   created_at: TIMESTAMP&#xa;   updated_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="THEATER">
          <mxGeometry y="26" width="200" height="154" as="geometry" />
        </mxCell>
        
        <!-- SCREEN Table -->
        <mxCell id="SCREEN" value="SCREEN" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="680" y="320" width="200" height="150" as="geometry" />
        </mxCell>
        <mxCell id="SCREEN-attrs" value="PK screen_id: UUID&#xa;FK theater_id: UUID&#xa;   screen_number: INTEGER&#xa;   capacity: INTEGER&#xa;   screen_type: VARCHAR(50)&#xa;   features: VARCHAR[]&#xa;   created_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SCREEN">
          <mxGeometry y="26" width="200" height="124" as="geometry" />
        </mxCell>
        
        <!-- SEAT Table -->
        <mxCell id="SEAT" value="SEAT" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="680" y="510" width="200" height="130" as="geometry" />
        </mxCell>
        <mxCell id="SEAT-attrs" value="PK seat_id: UUID&#xa;FK screen_id: UUID&#xa;   row_number: VARCHAR(5)&#xa;   seat_number: INTEGER&#xa;   seat_type: ENUM&#xa;   created_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SEAT">
          <mxGeometry y="26" width="200" height="104" as="geometry" />
        </mxCell>
        
        <!-- SHOW Table -->
        <mxCell id="SHOW" value="SHOW" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="360" y="680" width="220" height="170" as="geometry" />
        </mxCell>
        <mxCell id="SHOW-attrs" value="PK show_id: UUID&#xa;FK movie_id: UUID&#xa;FK screen_id: UUID&#xa;FK theater_id: UUID&#xa;   start_time: TIMESTAMP&#xa;   end_time: TIMESTAMP&#xa;   status: ENUM&#xa;   base_price: DECIMAL&#xa;   created_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SHOW">
          <mxGeometry y="26" width="220" height="144" as="geometry" />
        </mxCell>
        
        <!-- BOOKING Table -->
        <mxCell id="BOOKING" value="BOOKING" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="960" y="100" width="220" height="220" as="geometry" />
        </mxCell>
        <mxCell id="BOOKING-attrs" value="PK booking_id: UUID&#xa;FK user_id: UUID&#xa;FK show_id: UUID&#xa;FK saga_id: UUID&#xa;   total_amount: DECIMAL&#xa;   booking_status: ENUM&#xa;   version: BIGINT&#xa;   created_at: TIMESTAMP&#xa;   expires_at: TIMESTAMP&#xa;   confirmed_at: TIMESTAMP&#xa;   updated_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="BOOKING">
          <mxGeometry y="26" width="220" height="194" as="geometry" />
        </mxCell>
        
        <!-- BOOKING_SEAT Table -->
        <mxCell id="BOOKING_SEAT" value="BOOKING_SEAT" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="960" y="360" width="220" height="140" as="geometry" />
        </mxCell>
        <mxCell id="BOOKING_SEAT-attrs" value="PK booking_seat_id: UUID&#xa;FK booking_id: UUID&#xa;FK seat_id: UUID&#xa;FK show_id: UUID&#xa;   price: DECIMAL&#xa;   status: ENUM&#xa;   created_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="BOOKING_SEAT">
          <mxGeometry y="26" width="220" height="114" as="geometry" />
        </mxCell>
        
        <!-- PAYMENT Table -->
        <mxCell id="PAYMENT" value="PAYMENT" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1240" y="100" width="220" height="220" as="geometry" />
        </mxCell>
        <mxCell id="PAYMENT-attrs" value="PK payment_id: UUID&#xa;FK booking_id: UUID&#xa;FK user_id: UUID&#xa;   amount: DECIMAL&#xa;   payment_method: ENUM&#xa;   payment_status: ENUM&#xa;   transaction_id: VARCHAR(255)&#xa;   gateway_response: JSONB&#xa;   idempotency_key: UUID&#xa;   created_at: TIMESTAMP&#xa;   completed_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="PAYMENT">
          <mxGeometry y="26" width="220" height="194" as="geometry" />
        </mxCell>
        
        <!-- SAGA_STATE Table -->
        <mxCell id="SAGA_STATE" value="SAGA_STATE" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="960" y="560" width="220" height="200" as="geometry" />
        </mxCell>
        <mxCell id="SAGA_STATE-attrs" value="PK saga_id: UUID&#xa;FK booking_id: UUID&#xa;   current_step: ENUM&#xa;   saga_status: ENUM&#xa;   compensation_data: JSONB&#xa;   error_message: TEXT&#xa;   retry_count: INTEGER&#xa;   created_at: TIMESTAMP&#xa;   updated_at: TIMESTAMP&#xa;   completed_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SAGA_STATE">
          <mxGeometry y="26" width="220" height="174" as="geometry" />
        </mxCell>
        
        <!-- SAGA_STEP_STATE Table -->
        <mxCell id="SAGA_STEP" value="SAGA_STEP_STATE" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="960" y="810" width="220" height="180" as="geometry" />
        </mxCell>
        <mxCell id="SAGA_STEP-attrs" value="PK step_id: UUID&#xa;FK saga_id: UUID&#xa;   step_name: ENUM&#xa;   step_status: ENUM&#xa;   step_data: JSONB&#xa;   executed_at: TIMESTAMP&#xa;   compensated_at: TIMESTAMP&#xa;   error_message: TEXT" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SAGA_STEP">
          <mxGeometry y="26" width="220" height="154" as="geometry" />
        </mxCell>
        
        <!-- SEAT_LOCK Table (Redis/Cache) -->
        <mxCell id="SEAT_LOCK" value="SEAT_LOCK (Redis)" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="680" y="710" width="200" height="140" as="geometry" />
        </mxCell>
        <mxCell id="SEAT_LOCK-attrs" value="PK lock_id: String&#xa;   show_id: UUID&#xa;   seat_id: UUID&#xa;   user_id: UUID&#xa;   locked_at: TIMESTAMP&#xa;   expires_at: TIMESTAMP&#xa;   TTL: 900 seconds" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="SEAT_LOCK">
          <mxGeometry y="26" width="200" height="114" as="geometry" />
        </mxCell>
        
        <!-- INVENTORY Table -->
        <mxCell id="INVENTORY" value="INVENTORY" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1240" y="380" width="220" height="160" as="geometry" />
        </mxCell>
        <mxCell id="INVENTORY-attrs" value="PK inventory_id: UUID&#xa;FK show_id: UUID&#xa;   total_seats: INTEGER&#xa;   available_seats: INTEGER&#xa;   reserved_seats: INTEGER&#xa;   version: BIGINT&#xa;   updated_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="INVENTORY">
          <mxGeometry y="26" width="220" height="134" as="geometry" />
        </mxCell>
        
        <!-- NOTIFICATION Table -->
        <mxCell id="NOTIFICATION" value="NOTIFICATION" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1240" y="590" width="220" height="180" as="geometry" />
        </mxCell>
        <mxCell id="NOTIFICATION-attrs" value="PK notification_id: UUID&#xa;FK user_id: UUID&#xa;FK booking_id: UUID&#xa;   notification_type: ENUM&#xa;   channel: ENUM&#xa;   content: TEXT&#xa;   status: ENUM&#xa;   sent_at: TIMESTAMP&#xa;   created_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="NOTIFICATION">
          <mxGeometry y="26" width="220" height="154" as="geometry" />
        </mxCell>
        
        <!-- Relationships -->
        <!-- Theater to Screen -->
        <mxCell id="rel_theater_screen" edge="1" parent="1" source="THEATER" target="SCREEN" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Screen to Seat -->
        <mxCell id="rel_screen_seat" edge="1" parent="1" source="SCREEN" target="SEAT" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Movie to Show -->
        <mxCell id="rel_movie_show" edge="1" parent="1" source="MOVIE_WRITE" target="SHOW" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Screen to Show -->
        <mxCell id="rel_screen_show" edge="1" parent="1" source="SCREEN" target="SHOW" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- User to Booking -->
        <mxCell id="rel_user_booking" edge="1" parent="1" source="USER" target="BOOKING" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Show to Booking -->
        <mxCell id="rel_show_booking" edge="1" parent="1" source="SHOW" target="BOOKING" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="920" y="765" />
              <mxPoint x="920" y="265" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Booking to Booking_Seat -->
        <mxCell id="rel_booking_seat" edge="1" parent="1" source="BOOKING" target="BOOKING_SEAT" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Seat to Booking_Seat -->
        <mxCell id="rel_seat_booking" edge="1" parent="1" source="SEAT" target="BOOKING_SEAT" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="920" y="575" />
              <mxPoint x="920" y="430" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Booking to Payment -->
        <mxCell id="rel_booking_payment" edge="1" parent="1" source="BOOKING" target="PAYMENT" style="endArrow=ERone;startArrow=ERone;endFill=0;startFill=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Booking to SAGA_STATE -->
        <mxCell id="rel_booking_saga" edge="1" parent="1" source="BOOKING" target="SAGA_STATE" style="endArrow=ERone;startArrow=ERone;endFill=0;startFill=0;dashed=1;dashPattern=8 8;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- SAGA_STATE to SAGA_STEP -->
        <mxCell id="rel_saga_step" edge="1" parent="1" source="SAGA_STATE" target="SAGA_STEP" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Show to Inventory -->
        <mxCell id="rel_show_inventory" edge="1" parent="1" source="SHOW" target="INVENTORY" style="endArrow=ERone;startArrow=ERone;endFill=0;startFill=0;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="620" y="723" />
              <mxPoint x="620" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- User to Notification -->
        <mxCell id="rel_user_notif" edge="1" parent="1" source="USER" target="NOTIFICATION" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="320" y="243" />
              <mxPoint x="320" y="635" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Show to Seat_Lock -->
        <mxCell id="rel_show_lock" edge="1" parent="1" source="SHOW" target="SEAT_LOCK" style="endArrow=ERmany;startArrow=ERone;endFill=0;startFill=0;dashed=1;dashPattern=8 8;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Sync arrow between Write and Read -->
        <mxCell id="sync_movie" value="Event Sync" edge="1" parent="1" source="MOVIE_WRITE" target="MOVIE_READ" style="endArrow=open;endFill=0;dashed=1;strokeColor=#9673a6;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Indexes and Constraints Labels -->
        <mxCell id="indexLabel" value="Key Indexes:&#xa; BOOKING: (user_id, created_at)&#xa; BOOKING: (show_id, booking_status)&#xa; SHOW: (movie_id, start_time)&#xa; SHOW: (theater_id, start_time)&#xa; SAGA_STATE: (booking_id, saga_status)&#xa; MOVIE_READ: (city, release_date)" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="80" y="900" width="280" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="constraintLabel" value="Constraints:&#xa; BOOKING.version: Optimistic Locking&#xa; PAYMENT.idempotency_key: Unique&#xa; INVENTORY.version: Optimistic Locking&#xa; SAGA_STATE.retry_count: Max 3&#xa; SEAT_LOCK: TTL 15 minutes" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="900" width="280" height="120" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="SAGA Flow Diagram" id="saga-flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <mxCell id="titleSaga" value="SAGA Pattern - Booking Flow with Compensation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>
        
        <!-- Success Flow -->
        <mxCell id="successLabel" value="SUCCESS FLOW" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="600" height="30" as="geometry" />
        </mxCell>
        
        <!-- Step 1: Booking Service -->
        <mxCell id="saga_step1" value="1. Create Booking&#xa;(PENDING)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Step 2: Lock Seats -->
        <mxCell id="saga_step2" value="2. Lock Seats&#xa;(Redis)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="240" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Step 3: Reserve Inventory -->
        <mxCell id="saga_step3" value="3. Reserve Inventory&#xa;(Decrement)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Step 4: Process Payment -->
        <mxCell id="saga_step4" value="4. Process Payment&#xa;(Charge)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="560" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Step 5: Confirm Booking -->
        <mxCell id="saga_step5" value="5. Confirm Booking&#xa;(CONFIRMED)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Step 6: Send Notification -->
        <mxCell id="saga_step6" value="6. Send Notification&#xa;(Email/SMS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="880" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Success Flow Arrows -->
        <mxCell id="arrow1" edge="1" parent="1" source="saga_step1" target="saga_step2" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2" edge="1" parent="1" source="saga_step2" target="saga_step3" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3" edge="1" parent="1" source="saga_step3" target="saga_step4" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow4" edge="1" parent="1" source="saga_step4" target="saga_step5" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow5" edge="1" parent="1" source="saga_step5" target="saga_step6" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Failure Flow -->
        <mxCell id="failureLabel" value="FAILURE &amp; COMPENSATION FLOW" style="text;html=1;strokeColor=none;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="80" y="280" width="600" height="30" as="geometry" />
        </mxCell>
        
        <!-- Failure Step 1 -->
        <mxCell id="fail_step1" value="1. Create Booking&#xa;(PENDING)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Failure Step 2 -->
        <mxCell id="fail_step2" value="2. Lock Seats&#xa;(Success)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="240" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Failure Step 3 -->
        <mxCell id="fail_step3" value="3. Reserve Inventory&#xa;(Success)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Failure Step 4 -->
        <mxCell id="fail_step4" value="4. Process Payment&#xa;(FAILED)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="560" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Compensation Steps -->
        <mxCell id="comp_step1" value="Compensate 3:&#xa;Release Inventory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="comp_step2" value="Compensate 2:&#xa;Unlock Seats" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="240" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="comp_step3" value="Final: Cancel Booking&#xa;(CANCELLED)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Failure Flow Arrows -->
        <mxCell id="fail_arrow1" edge="1" parent="1" source="fail_step1" target="fail_step2" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#666666;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fail_arrow2" edge="1" parent="1" source="fail_step2" target="fail_step3" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#666666;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fail_arrow3" edge="1" parent="1" source="fail_step3" target="fail_step4" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#666666;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Compensation Arrows -->
        <mxCell id="comp_arrow1" edge="1" parent="1" source="fail_step4" target="comp_step1" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#d79b00;dashed=1;dashPattern=8 8;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="comp_arrow2" edge="1" parent="1" source="comp_step1" target="comp_step2" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#d79b00;dashed=1;dashPattern=8 8;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="comp_arrow3" edge="1" parent="1" source="comp_step2" target="comp_step3" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#d79b00;dashed=1;dashPattern=8 8;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- SAGA State Machine -->
        <mxCell id="stateMachineLabel" value="SAGA STATE TRANSITIONS" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="580" width="920" height="30" as="geometry" />
        </mxCell>
        
        <!-- States -->
        <mxCell id="state_started" value="STARTED" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="120" y="640" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="state_processing" value="PROCESSING" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="640" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="state_completed" value="COMPLETED" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="440" y="640" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="state_compensating" value="COMPENSATING" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="state_failed" value="FAILED" style="ellipse;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="140" y="760" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- State Transitions -->
        <mxCell id="trans1" edge="1" parent="1" source="state_started" target="state_processing" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="trans2" edge="1" parent="1" source="state_processing" target="state_completed" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="trans3" edge="1" parent="1" source="state_processing" target="state_compensating" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#d79b00;">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="330" y="700" as="sourcePoint" />
            <mxPoint x="340" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="trans4" edge="1" parent="1" source="state_compensating" target="state_failed" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#b85450;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legendBox" value="LEGEND" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;align=left;verticalAlign=top;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1100" y="130" width="400" height="260" as="geometry" />
        </mxCell>
        
        <mxCell id="legend1" value="Success Step" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1120" y="160" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend1_text" value="Step executes successfully" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1230" y="160" width="250" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend2" value="Failed Step" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1120" y="200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend2_text" value="Step fails, triggers compensation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1230" y="200" width="250" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend3" value="Compensation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1120" y="240" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend3_text" value="Rollback/Undo operation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1230" y="240" width="250" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend4" value="Completed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1120" y="280" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="legend4_text" value="Final successful state" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1230" y="280" width="250" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend5" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#d79b00;dashed=1;dashPattern=8 8;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1120" y="335" as="sourcePoint" />
            <mxPoint x="1220" y="335" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend5_text" value="Compensation flow (reverse order)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1230" y="320" width="250" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend6" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1120" y="365" as="sourcePoint" />
            <mxPoint x="1220" y="365" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend6_text" value="Success flow (forward order)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1230" y="350" width="250" height="30" as="geometry" />
        </mxCell>
        
        <!-- Compensation Details -->
        <mxCell id="compDetails" value="COMPENSATION ACTIONS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;align=left;verticalAlign=top;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1100" y="420" width="400" height="240" as="geometry" />
        </mxCell>
        
        <mxCell id="comp_detail1" value="Step 2 Compensation:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1120" y="450" width="360" height="20" as="geometry" />
        </mxCell>
        <mxCell id="comp_detail1_desc" value=" Delete seat locks from Redis&#xa; Publish SeatUnlocked event" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1120" y="470" width="360" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="comp_detail2" value="Step 3 Compensation:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1120" y="520" width="360" height="20" as="geometry" />
        </mxCell>
        <mxCell id="comp_detail2_desc" value=" Increment available_seats in Inventory&#xa; Use optimistic locking (version++)&#xa; Publish InventoryReleased event" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1120" y="540" width="360" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="comp_detail3" value="Step 4 Compensation:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1120" y="610" width="360" height="20" as="geometry" />
        </mxCell>
        <mxCell id="comp_detail3_desc" value=" Initiate refund via Payment Gateway&#xa; Update payment status to REFUNDED" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1120" y="630" width="360" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  
  <diagram name="CQRS Event Flow" id="cqrs-flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <mxCell id="titleCQRS" value="CQRS Pattern - Command &amp; Query Separation with Event Sourcing" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="700" height="40" as="geometry" />
        </mxCell>
        
        <!-- Client -->
        <mxCell id="client" value="Client/API Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="120" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Command Side -->
        <mxCell id="commandSideBox" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=20;" vertex="1" parent="1">
          <mxGeometry x="280" y="80" width="400" height="380" as="geometry" />
        </mxCell>
        
        <mxCell id="commandLabel2" value="COMMAND SIDE (Write)" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="380" y="90" width="200" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="commandHandler" value="Command Handler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="320" y="140" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="aggregateRoot" value="Aggregate Root&#xa;(Domain Model)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="500" y="140" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="writeDB" value="Write Database&#xa;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="330" y="240" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="eventStore" value="Event Store&#xa;(Event Log)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="510" y="240" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="eventBus2" value="Event Bus (Kafka)&#xa;Topics:&#xa;- movie.created&#xa;- movie.updated&#xa;- show.created" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="320" y="360" width="320" height="80" as="geometry" />
        </mxCell>
        
        <!-- Query Side -->
        <mxCell id="querySideBox" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;opacity=20;" vertex="1" parent="1">
          <mxGeometry x="760" y="80" width="540" height="380" as="geometry" />
        </mxCell>
        
        <mxCell id="queryLabel2" value="QUERY SIDE (Read)" style="text;html=1;strokeColor=none;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="930" y="90" width="200" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="eventHandler2" value="Event Handler&#xa;(Projector)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="800" y="140" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="readDB" value="Read Database&#xa;(MongoDB)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="980" y="140" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="cache" value="Cache Layer&#xa;(Redis)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1140" y="140" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="queryHandler" value="Query Handler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="800" y="260" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="readModel" value="Read Models&#xa;(Materialized Views)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="980" y="260" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="searchEngine" value="Search Engine&#xa;(Elasticsearch)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1140" y="260" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="queryAPI" value="Query API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="960" y="380" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Arrows -->
        <mxCell id="cqrs_arrow1" value="Write Command" edge="1" parent="1" source="client" target="commandHandler" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow2" edge="1" parent="1" source="commandHandler" target="aggregateRoot" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow3" edge="1" parent="1" source="aggregateRoot" target="writeDB" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow4" edge="1" parent="1" source="aggregateRoot" target="eventStore" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow5" value="Publish Events" edge="1" parent="1" source="eventStore" target="eventBus2" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#9673a6;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow6" value="Subscribe" edge="1" parent="1" source="eventBus2" target="eventHandler2" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#9673a6;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="720" y="400" />
              <mxPoint x="720" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cqrs_arrow7" value="Project/Sync" edge="1" parent="1" source="eventHandler2" target="readDB" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow8" edge="1" parent="1" source="eventHandler2" target="cache" style="endArrow=classic;html=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow9" edge="1" parent="1" source="readDB" target="readModel" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow10" edge="1" parent="1" source="eventHandler2" target="searchEngine" style="endArrow=classic;html=1;strokeWidth=2;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1100" y="200" />
              <mxPoint x="1100" y="300" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cqrs_arrow11" edge="1" parent="1" source="readModel" target="queryHandler" style="endArrow=classic;html=1;strokeWidth=2;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow12" edge="1" parent="1" source="queryHandler" target="queryAPI" style="endArrow=classic;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_arrow13" value="Read Query" edge="1" parent="1" source="client" target="queryAPI" style="endArrow=classic;html=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="150" />
              <mxPoint x="240" y="550" />
              <mxPoint x="880" y="550" />
              <mxPoint x="880" y="410" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Example Commands and Queries -->
        <mxCell id="exampleBox" value="EXAMPLE OPERATIONS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;align=left;verticalAlign=top;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="80" y="520" width="1220" height="300" as="geometry" />
        </mxCell>
        
        <mxCell id="commandExamples" value="COMMANDS (Write Operations)" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontStyle=1;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="100" y="550" width="560" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="cmd1" value="1. CreateMovieCommand" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="120" y="590" width="520" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cmd1_desc" value="    Validates movie data&#xa;    Saves to Write DB (PostgreSQL)&#xa;    Publishes MovieCreatedEvent&#xa;    Event contains: movieId, title, genre, releaseDate" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="120" y="610" width="520" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="cmd2" value="2. CreateShowCommand" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="120" y="690" width="520" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cmd2_desc" value="    Links movie, theater, screen&#xa;    Creates show with timing and pricing&#xa;    Publishes ShowCreatedEvent&#xa;    Updates inventory service" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="120" y="710" width="520" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="queryExamples" value="QUERIES (Read Operations)" style="text;html=1;strokeColor=none;fillColor=#fff2cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontStyle=1;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="700" y="550" width="560" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="query1" value="1. GetMoviesByCity(city, date)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="590" width="520" height="20" as="geometry" />
        </mxCell>
        <mxCell id="query1_desc" value="    Reads from MongoDB read model&#xa;    Uses city index for fast lookup&#xa;    Returns: movies + theaters + show times&#xa;    Cached in Redis for 5 minutes" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="720" y="610" width="520" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="query2" value="2. SearchMovies(query, filters)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="690" width="520" height="20" as="geometry" />
        </mxCell>
        <mxCell id="query2_desc" value="    Uses Elasticsearch for full-text search&#xa;    Filters: genre, language, rating, city&#xa;    Returns ranked results&#xa;    No impact on write database" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="720" y="710" width="520" height="70" as="geometry" />
        </mxCell>
        
        <!-- Benefits Box -->
        <mxCell id="benefitsLabel" value="BENEFITS OF CQRS" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="850" width="1220" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>